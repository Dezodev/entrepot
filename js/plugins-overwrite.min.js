/*! entrepot - v1.2.0 - 2017-11-02 3:28:15 AM UTC - https://imathi.eu/tag/entrepot */
window.wp=window.wp||{},window.entrepot=window.entrepot||_.extend({},_.pick(window.wp,"apiRequest","template")),function(a,b,c){c.notice=c.template("entrepot-notice"),c.upload=function(a,b,c){var d,e,f={"X-Requested-With":"XMLHttpRequest","X-WP-Nonce":wpApiSettings.nonce,"Cache-Control":"no-cache, must-revalidate, max-age=0"};e=wpApiSettings.root+a.replace(/^\//,""),b=b||{},d="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.onreadystatechange=function(a){if(a.currentTarget&&4===a.currentTarget.readyState){var b,d=JSON.parse(a.currentTarget.responseText);b=d.status?d.status:a.currentTarget.status,c&&c(b,d)}},d.open("POST",e);for(var g in f)d.setRequestHeader(g,f[g]);d.send(b)},a(document).ready(function(){var d=c.template("entrepot-plugin-version"),e=a("#list-plugin-versions");c.apiRequest({path:"wp/v2/plugins/",type:"GET",dataType:"json"}).done(function(b){a("#entrepot-loading-plugins").remove(),a.each(b,function(a,b){e.append(d(b))}),a("img.plugin-icon").on("error",function(b){b.preventDefault(),a(b.currentTarget).parent().find(".dashicons-admin-plugins").first().removeClass("hide"),a(b.currentTarget).remove()})}).fail(function(d){var e={id:"list-plugin-versions-error",code:400};d&&d.responseJSON?b.extend(e,{code:d.responseJSON.status,message:d.responseJSON.message}):e.message=entrepotl10nPluginsOverwrite.unknownError,a("#entrepot-loading-plugins").html(c.notice(e))})}),a("#list-plugin-versions").on("change",'input[type="file"]',function(d){var e,f=a(d.currentTarget),g=f.prop("name"),h=new FormData,i=f.data("plugin-id"),j=f.parent().find("label").first(),k=f.parent().find(".update-now").first(),l=f.parents(".plugin-card");if(d.currentTarget.files){if(l.find("#notice-"+g).length&&l.find("#notice-"+g).remove(),e=b.first(d.currentTarget.files),"application/zip"!==e.type)return void l.append(c.notice({id:"notice-"+g,code:403,message:entrepotl10nPluginsOverwrite.filetypeError}));j.addClass("updating"),k.addClass("updating-message"),h.append(g,e),h.append("id",i),f.val(""),c.upload("wp/v2/plugins/"+g+"/?package="+i,h,function(d,e){var f={id:"notice-"+g,code:d};j.removeClass("updating"),k.removeClass("updating-message"),200!==d?(f.message=entrepotl10nPluginsOverwrite.unknownError,e&&e.message&&(f.message=e.message)):(b.extend(f,{message:e.message}),e.newVersion&&e.oldVersion&&j.html(j.html().replace(e.oldVersion,e.newVersion))),l.append(c.notice(f)),a(document).trigger("wp-updates-notice-added")})}})}(jQuery,_,window.entrepot);