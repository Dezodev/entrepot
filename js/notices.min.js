/*! entrepot - v1.2.0-alpha - 2017-07-26 7:05:11 PM UTC - https://imathi.eu/tag/entrepot */
window.entrepot=window.entrepot||{},function(a){return"undefined"!=typeof entrepotNoticesl10n&&(window.entrepot.Notices={getStorage:function(a,b){var c=localStorage.getItem(a);return c=c?JSON.parse(c):{},void 0!==b&&c[b]?c[b]:c},setStorage:function(a,b,c){var d=this.getStorage(a);return void 0===c&&void 0!==d[b]?delete d[b]:d[b]=c,localStorage.setItem(a,JSON.stringify(d)),null!==localStorage.getItem(a)},refreshCount:function(b,c){var d,e,f=parseInt(a("#show-entrepot-notices-link .count").html(),10);if(c&&(d=parseInt(a("#tab-link-entrepot-notice-"+c+" .count").html(),10)),b||(b=0),f-=b,d-=b,f<=0)a("#show-entrepot-notices-link").hasClass("screen-meta-active")&&a("#show-entrepot-notices-link").trigger("click"),a("#screen-entrepot-notices-wrap").remove(),a("#entrepot-notices-link-wrap").remove();else{if(a("#show-entrepot-notices-link .count").html(f),!c)return;d<=0?(e=a("#tab-link-entrepot-notice-"+c).parent(),a("#tab-link-entrepot-notice-"+c).remove(),e.children().length&&a(e).find("a").first().trigger("click")):a("#tab-link-entrepot-notice-"+c+" .count").html(d)}},getNoticeId:function(a){return!!a&&(a=a.replace(new RegExp(/\n*\t*\s*/,"g"),"").substring(3,23),window.btoa(decodeURI(encodeURIComponent(a))))},injectNoticesCenter:function(){var b=this;a("#screen-meta-links").length||a("#screen-meta").after(a("<div></div>").prop("id","screen-meta-links")),a("#screen-meta").append(a("<div></div>").prop({id:"screen-entrepot-notices-wrap",tabindex:"-1"}).addClass("hidden").append(a("<div></div>").prop("id","entrepot-notices-back")).append(a("<div></div>").prop("id","entrepot-notices-columns").append(a("<div></div>").addClass("contextual-help-tabs").html(a("<ul></ul>"))).append(a("<div></div>").addClass("contextual-help-tabs-wrap")))),a("#screen-meta-links").append(a("<div></div>").prop("id","entrepot-notices-link-wrap").addClass("hide-if-no-js screen-meta-toggle").html(a("<button></button>").prop({type:"button",id:"show-entrepot-notices-link"}).attr("aria-controls","screen-entrepot-notices-wrap").attr("aria-expanded",!1).addClass("button show-entrepot-notices show-settings").html(b.strings.tabTitle)))},populateNotices:function(){var b=this;b.encodedNotices={},a.each(b.notices,function(c,d){var e="";if(b.encodedNotices[c]=[],"upgrade"!==c&&(e=' class="entrepot-notice-trashable"'),d.length){if(a("#screen-entrepot-notices-wrap .contextual-help-tabs ul").append(a("<li></li>").prop("id","tab-link-entrepot-notice-"+c).addClass(c).html(a("<a></a>").prop("href","#tab-panel-entrepot-notice-"+c).attr("aria-controls","tab-panel-entrepot-notice-"+c).html(b.strings.tabLiTitles[c]))),a.each(d,function(d,e){var f=b.getNoticeId(e),g=b.getStorage("notices",c);g&&-1!==a.inArray(f,g)||b.encodedNotices[c].push({id:f,content:e})}),!b.encodedNotices[c].length)return void b.refreshCount(d.length,c);b.encodedNotices[c].length!==d.length&&b.refreshCount(d.length-b.encodedNotices[c].length,c),a("#screen-entrepot-notices-wrap .contextual-help-tabs-wrap").append(a("<div></div>").prop("id","tab-panel-entrepot-notice-"+c).addClass("help-tab-content entrepot-"+c)),a.each(b.encodedNotices[c],function(b,d){a("#tab-panel-entrepot-notice-"+c).append("<div"+e+' data-id="'+d.id+'" data-type="'+c+'">'+d.content+"</div>")})}}),a("#screen-entrepot-notices-wrap .contextual-help-tabs ul li").first().addClass("active"),a("#screen-entrepot-notices-wrap .contextual-help-tabs-wrap div").first().addClass("active"),a.each(a("#screen-entrepot-notices-wrap .entrepot-notice-trashable"),function(c,d){var e=a(d);e.append(a("<button></button>").prop("type","button").addClass("entrepot-notice-trash").html(a("<span></span>").addClass("screen-reader-text").text(b.strings.trash||"")))})},trashNotice:function(b){b.preventDefault();var c=a(b.currentTarget).parent(),d=this.getStorage("notices",c.data("type"));d.length||(d=[]),d.push(c.data("id")),this.setStorage("notices",c.data("type"),d),c.fadeTo(100,0,function(){c.slideUp(100,function(){c.remove()})}),this.refreshCount(1,c.data("type"))},switchActiveTab:function(b){var c,d=a(this);return b.preventDefault(),!d.is(".active a")&&(a("#screen-entrepot-notices-wrap .contextual-help-tabs .active").removeClass("active"),d.parent("li").addClass("active"),c=a(d.attr("href")),a("#screen-entrepot-notices-wrap .help-tab-content").not(c).removeClass("active").hide(),void c.addClass("active").show())},init:function(){var b=this;a.extend(this,entrepotNoticesl10n,{hasNotice:!1}),a.each(this.notices,function(a,c){c.length&&(b.hasNotice=!0)}),this.hasNotice&&(this.injectNoticesCenter(),this.populateNotices(),a("#screen-entrepot-notices-wrap .contextual-help-tabs").on("click","a",this.switchActiveTab),a("#screen-entrepot-notices-wrap").on("click","button.entrepot-notice-trash",this.trashNotice.bind(this)))}},void window.entrepot.Notices.init())}(jQuery);